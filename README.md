# EVD.COVID_ANALYSIS

## Table of Contents

1. [Overview](#overview)

2. [Folder Structure : Data and Codes](#folder-structure)
   - [Database](#database)
   - [Scripts](#scripts)
     - [1_Preprocessing](#1_preprocessing)
     - [2_Feedback_Scripts](#2_feedback_scripts)
     - [3_Training_and_Annotation](#3_training_and_annotation)
     - [4_Data_Analysis](#4_data_analysis)
   - [Models](#models)
   - [Results](#results)

3. [Annotation Performance Metrics](#annotation-performance-metrics)

4. [Section en FranÃ§ais](#section-en-fran%C3%A7ais)

## Overview

This repository contains scripts and data for processing, training, and analyzing text data related to COVID-19 press conferences in Quebec and Sweden. The primary goal is to preprocess the data, train models, annotate sentences, and conduct data analysis to understand the policies and measures taken by these countries during the pandemic. The annotation methodology is based on the approach described in [Do et al. (2022)](https://journals.sagepub.com/doi/pdf/10.1177/00491241221134526?casa_token=je4hEAkbGj4AAAAA:DF8Co2J-JzFNMycjRfroCdfrLB0Qivqu3WM_U83eX2oW17eJ-mh2jxTD6ai-fKoz_wICW_OQg0qkYMs), which uses sequential transfer learning to annotate large-scale text data.

The results of these analyses contribute to our understanding of how different frames influenced policy and evidence use during the COVID-19 pandemic. This method is used in the following working paper:

<p align="center">
  <img src="/Results/abstract.png" alt="Abstract">
</p>

## Folder Structure : Data and Codes

### ğŸ“‚ Database

This folder contains various subdirectories for different types of data used in the project:

- #### ğŸ“‚ original_data
  - **Content**: Raw text data from Quebec and Sweden's COVID-19 press conferences coming transmitted by the Public health agency of Sweden, or extracted [in another project](https://github.com/antoinelemor/QC.Uncertainty_COVID).

- #### ğŸ“‚ epidemiology
  - **Content**: Epidemiological data for Quebec and Sweden, including COVID-19 cases, hospitalizations, vaccination data, and stringency index coming from the INSPQ for Quebec, or the ECDC for Sweden.

- #### ğŸ“‚ preprocessed_data
  - **Content**: Preprocessed text data ready for annotation and analysis.

- #### ğŸ“‚ verification_annotation_data
  - **Content**: JSONL files containing the evaluation, test, and training data (manual annotations using Doccano) for both Quebec and Sweden.

- #### ğŸ“‚ training_data_per_label_per_country
  - **Content**: Subdirectories for Quebec (QC) and Sweden (SWD) containing JSONL files for various manual annotation labels used in model training.

- #### ğŸ“‚ pred
  - **Content**: Subdirectories for Quebec (perf_QC) and Sweden (perf_SE) containing performance logs (e.g., F1 scores) of the annotation models.

### ğŸ“‚ Scripts

This folder contains four subdirectories, each dedicated to a specific part of the project workflow:

#### ğŸ“‚ 1_Preprocessing

This subdirectory includes scripts for preprocessing the text data, specifically for Quebec and Sweden.

- **1_Preprocessed_QC.py**:
  - **Objectifs**: Preprocesses text data from Quebec by removing English sentences, tokenizing the text, and creating sentence contexts.

- **1_Preprocessed_SWD.py**:
  - **Objectifs**: Similar to the Quebec preprocessing script, but for Swedish text data. It removes English sentences, tokenizes the text, and creates sentence contexts.

- **2_Sentences_to_annotate.py**:
  - **Objectifs**: Calculates the number of sentences that need to be annotated for both Quebec and Sweden with a CI of 95%.

#### ğŸ“‚ 2_Feedback_Scripts

This subdirectory includes scripts to process and prepare data for annotation feedback.

- **1_JSONL_Annotation.py**:
  - **Objectifs**: Converts annotation data to JSONL format for processing.

- **2_Supplementary_sent_JSONL_FR.py**:
  - **Objectifs**: Processes additional French sentences into JSONL format.

- **2_Supplementary_sent_JSONL_SWD.py**:
  - **Objectifs**: Processes additional Swedish sentences into JSONL format.

- **2_Translate_JSONL_for_annotation.py**:
  - **Objectifs**: Translates sentences to be annotated and formats them into JSONL.

- **3_JSONL_train_AS.py**:
  - **Objectifs**: Prepares JSONL files for training annotation models.

#### ğŸ“‚ 3_Training_and_Annotation

This subdirectory contains scripts for training models and annotating text data.

- **1_Train_QC.py**:
  - **Objectifs**: Trains models using the Quebec text data.

- **1_Train_SWD.py**:
  - **Objectifs**: Trains models using the Swedish text data.

- **2_Predict_QC.py**:
  - **Objectifs**: Makes predictions and annotate the Quebec database using models trained on Quebec data.

- **2_Predict_SWD.py**:
  - **Objectifs**: Makes predictions and annotate the Swedish database using models trained on Swedish data.

#### ğŸ“‚ 4_Data_Analysis

This subdirectory includes scripts for analyzing the processed and annotated data.

- **1.Database_creation.R**:
  - **Objectifs**: Creates databases from the textual and epidemiological data.

- **2.Graphs_and_plot.R**:
  - **Objectifs**: Generates graphs and plots for visual data analysis based on OLS models performed in the 3.Models.R.

- **3.Models.R**:
  - **Objectifs**: Runs OLS models on the data.

- **4.Robustness.R**:
  - **Objectifs**: Tests the robustness of the statistical models.

### ğŸ“‚ Models

This folder contains the trained models for each country and category. Note that these models are not included in the repository due to their size.

### ğŸ“‚ Results

This folder contains all the results produced by the R scripts in the Data Analysis folder.

## Annotation Performance Metrics

### Annotation Metrics

<p align="center">
  <img src="/Results/annotation_metrics.png" alt="Annotation Metrics">
</p>

## Section en FranÃ§ais

### Vue d'ensemble

Ce dÃ©pÃ´t contient des scripts et des donnÃ©es pour le traitement, l'entraÃ®nement et l'analyse des donnÃ©es textuelles relatives aux confÃ©rences de presse sur la COVID-19 au QuÃ©bec et en SuÃ¨de. L'objectif principal est de prÃ©traiter les donnÃ©es, d'entraÃ®ner des modÃ¨les, d'annoter des phrases et de rÃ©aliser une analyse des donnÃ©es pour comprendre les politiques et les mesures prises par ces pays pendant la pandÃ©mie. La mÃ©thodologie d'annotation est basÃ©e sur l'approche dÃ©crite dans [Do et al. (2022)](https://journals.sagepub.com/doi/pdf/10.1177/00491241221134526?casa_token=je4hEAkbGj4AAAAA:DF8Co2J-JzFNMycjRfroCdfrLB0Qivqu3WM_U83eX2oW17eJ-mh2jxTD6ai-fKoz_wICW_OQg0qkYMs), qui utilise l'apprentissage par transfert sÃ©quentiel pour annoter des donnÃ©es textuelles Ã  grande Ã©chelle.

Les rÃ©sultats de ces analyses contribuent Ã  notre comprÃ©hension de la maniÃ¨re dont diffÃ©rents cadres ont influencÃ© l'utilisation des politiques et des preuves pendant la pandÃ©mie de COVID-19. Cette mÃ©thode est utilisÃ©e dans le document de travail suivant :

<p align="center">
  <img src="/Results/abstract.png" alt="Abstract">
</p>

### Structure des Dossiers : DonnÃ©es et Codes

#### ğŸ“‚ Base de donnÃ©es

Ce dossier contient divers sous-rÃ©pertoires pour les diffÃ©rents types de donnÃ©es utilisÃ©es dans le projet :

- #### ğŸ“‚ original_data
  - **Contenu** : DonnÃ©es textuelles brutes des confÃ©rences de presse sur la COVID-19 au QuÃ©bec et en SuÃ¨de, transmises par l'Agence de santÃ© publique de SuÃ¨de, ou extraites [dans un autre projet](https://github.com/antoinelemor/QC.Uncertainty_COVID).

- #### ğŸ“‚ epidemiology
  - **Contenu** : DonnÃ©es Ã©pidÃ©miologiques pour le QuÃ©bec et la SuÃ¨de, y compris les cas de COVID-19, les hospitalisations, les donnÃ©es sur la vaccination et l'indice de sÃ©vÃ©ritÃ© provenant de l'INSPQ pour le QuÃ©bec, ou de l'ECDC pour la SuÃ¨de.

- #### ğŸ“‚ preprocessed_data
  - **Contenu** : DonnÃ©es textuelles prÃ©traitÃ©es prÃªtes pour l'annotation et l'analyse.

- #### ğŸ“‚ verification_annotation_data
  - **Contenu** : Fichiers JSONL contenant les donnÃ©es d'Ã©valuation, de test et d'entraÃ®nement (annotations manuelles utilisant Doccano) pour le QuÃ©bec et la SuÃ¨de.

- #### ğŸ“‚ training_data_per_label_per_country
  - **Contenu** : Sous-rÃ©pertoires pour le QuÃ©bec (QC) et la SuÃ¨de (SWD) contenant des fichiers JSONL pour divers labels d'annotation manuels utilisÃ©s dans l'entraÃ®nement des modÃ¨les.

- #### ğŸ“‚ pred
  - **Contenu** : Sous-rÃ©pertoires pour le QuÃ©bec (perf_QC) et la SuÃ¨de (perf_SE) contenant des journaux de performance (par exemple, les scores F1) des modÃ¨les d'annotation.

#### ğŸ“‚ Scripts

Ce dossier contient quatre sous-rÃ©pertoires, chacun dÃ©diÃ© Ã  une partie spÃ©cifique du flux de travail du projet :

#### ğŸ“‚ 1_Preprocessing

Ce sous-rÃ©pertoire comprend des scripts pour le prÃ©traitement des donnÃ©es textuelles, spÃ©cifiquement pour le QuÃ©bec et la SuÃ¨de.

- **1_Preprocessed_QC.py** :
  - **Objectifs** : PrÃ©traite les donnÃ©es textuelles du QuÃ©bec en supprimant les phrases en anglais, en tokenisant le texte et en crÃ©ant des contextes de phrases.

- **1_Preprocessed_SWD.py** :
  - **Objectifs** : Similaire au script de prÃ©traitement pour le QuÃ©bec, mais pour les donnÃ©es textuelles suÃ©doises. Il supprime les phrases en anglais, tokenize le texte et crÃ©e des contextes de phrases.

- **2_Sentences_to_annotate.py** :
  - **Objectifs** : Calcule le nombre de phrases Ã  annoter pour le QuÃ©bec et la SuÃ¨de avec un CI de 95%.

#### ğŸ“‚ 2_Feedback_Scripts

Ce sous-rÃ©pertoire comprend des scripts pour traiter et prÃ©parer les donnÃ©es pour les retours d'annotation.

- **1_JSONL_Annotation.py** :
  - **Objectifs** : Convertit les donnÃ©es d'annotation en format JSONL pour le traitement.

- **2_Supplementary_sent_JSONL_FR.py** :
  - **Objectifs** : Traite les phrases supplÃ©mentaires en franÃ§ais au format JSONL.

- **2_Supplementary_sent_JSONL_SWD.py** :
  - **Objectifs** : Traite les phrases supplÃ©mentaires en suÃ©dois au format JSONL.

- **2_Translate_JSONL_for_annotation.py** :
  - **Objectifs** : Traduit les phrases Ã  annoter et les formate en JSONL.

- **3_JSONL_train_AS.py** :
  - **Objectifs** : PrÃ©pare les fichiers JSONL pour l'entraÃ®nement des modÃ¨les d'annotation.

#### ğŸ“‚ 3_Training_and_Annotation

Ce sous-rÃ©pertoire contient des scripts pour l'entraÃ®nement des modÃ¨les et l'annotation des donnÃ©es textuelles.

- **1_Train_QC.py** :
  - **Objectifs** : EntraÃ®ne les modÃ¨les en utilisant les donnÃ©es textuelles du QuÃ©bec.

- **1_Train_SWD.py** :
  - **Objectifs** : EntraÃ®ne les modÃ¨les en utilisant les donnÃ©es textuelles suÃ©doises.

- **2_Predict_QC.py** :
  - **Objectifs** : Fait des prÃ©dictions et annoter la base de donnÃ©es du QuÃ©bec en utilisant les modÃ¨les entraÃ®nÃ©s sur les donnÃ©es du QuÃ©bec.

- **2_Predict_SWD.py** :
  - **Objectifs** : Fait des prÃ©dictions et annoter la base de donnÃ©es suÃ©doise en utilisant les modÃ¨les entraÃ®nÃ©s sur les donnÃ©es suÃ©doises.

#### ğŸ“‚ 4_Data_Analysis

Ce sous-rÃ©pertoire comprend des scripts pour analyser les donnÃ©es traitÃ©es et annotÃ©es.

- **1.Database_creation.R** :
  - **Objectifs** : CrÃ©e des bases de donnÃ©es Ã  partir des donnÃ©es textuelles et Ã©pidÃ©miologiques.

- **2.Graphs_and_plot.R** :
  - **Objectifs** : GÃ©nÃ¨re des graphiques et des tracÃ©s pour l'analyse visuelle des donnÃ©es basÃ©e sur les modÃ¨les OLS rÃ©alisÃ©s dans le fichier 3.Models.R.

- **3.Models.R** :
  - **Objectifs** : ExÃ©cute les modÃ¨les OLS sur les donnÃ©es.

- **4.Robustness.R** :
  - **Objectifs** : Teste la robustesse des modÃ¨les statistiques.

#### ğŸ“‚ Models

Ce dossier contient les modÃ¨les entraÃ®nÃ©s pour chaque pays et catÃ©gorie. Notez que ces modÃ¨les ne sont pas inclus dans le dÃ©pÃ´t en raison de leur taille.

#### ğŸ“‚ Results

Ce dossier contient tous les rÃ©sultats produits par les scripts R dans le dossier Analyse des DonnÃ©es.

## Annotation Performance Metrics

### Annotation Metrics

<p align="center">
  <img src="/Results/annotation_metrics.png" alt="Annotation Metrics">
</p>
